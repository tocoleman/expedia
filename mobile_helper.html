

<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Bootstrap, Twitter's open source UI framework -->
    <link rel="stylesheet" href="http://twitter.github.io/bootstrap/assets/css/bootstrap.css"></link>

    <!-- jQuery -->
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
</head>
<body>
<div class="container">
    <form class="well">
        <fieldset>

            <label>Environment</label>
            <select id="environmentDropDown">
                <option value="">Live</option>
                <option value=".trunk.sb.karmalab.net" selected>trunk</option>
                <option value=".integration.sb.karmalab.net">RC</option>
                <option value=".int-milan.sb.karmalab.net">HF</option>
                <option value="pull_from_edit_box">local-host-ip</option>
                <option value=".chelwebestr34.bgb.karmalab.net">IS A</option>
                <option value=".chelwebestr09.bgb.karmalab.net">IS B</option>
                <option value=".trunk-stubbed.sb.karmalab.net">stub</option>
                <option value=".localhost">local</option>
                <option value=".sandbox.dev.sb.karmalab.net">Sandbox</option>
            </select>
            <input type="text" value="" id="local-host-ip"/><br>

            <br>
            <label>Point of Sale</label>
            <select id="POS">
                <option value="0">Select</option>
                <option value="www.expedia.com" selected>US - 1</option>
                <option value="www.expedia.com.au" >AU - 25</option>
                <option value="www.expedia.co.uk" >UK - 3</option>
                <option value="www.expedia.ca" >CA - 4</option>
                <option value="www.expedia.com.br" >BR - 69</option>
                <option value="www.expedia.de" >DE - 6</option>
                <option value="agence.voyages-sncf.com" >VSC - 7</option>
                <option value="www.expedia.it" >IT - 8</option>
                <option value="www.expedia.es" >ES - 9</option>
                <option value="www.expedia.nl" >NL - 11</option>
                <option value="www.expedia.mx" >MX - 12</option>
                <option value="www.travelocity.com" >TRV - 80001</option>
                <option value="www.travelocity.com" >TRC - 80004</option>
                <option value="www.expedia.com.sg" >SG - 14</option>
                <option value="www.expedia.com.my" >MY - 15</option>
                <option value="www.expedia.co.kr" >KR - 16</option>
                <option value="www.expedia.co.th" >TH - 17</option>
                <option value="www.expedia.com.hk" >HK - 18</option>
                <option value="www.expedia.fr" >FR - 20</option>
                <option value="www.expedia.co.in" >IN - 27</option>
                <option value="www.expedia.co.jp" >JP - 28</option>
                <option value="www.expedia.co.nz" >NZ - 29</option>
                <option value="www.wotif.com" >WAU - 70125</option>
                <option value="www.wotif.co.nz" >WNZ - 70129</option>
                <option value="www.cheaptickets.com" >CTK - 70301</option>
                <option value="www.orbitz.com" >ORB - 70201</option>
            </select><br>

            <label>Experiment ID</label>
            <input type="number" value="11358" id="experiment-id" size="4"/>
            <input id="see-bucket-button" type="button" class="update-button btn btn-primary" value="See Bucket.." />
            <br>

            <label>Experiment Name</label>
            <input type="text" value="name" id="experiment-name" size="25"/>
            <input id="store-experiment-button" type="button" class="update-button btn btn-primary" value="Remember Experiment in Table" />
            <br>

            <label>Treatment/Bucket</label>
            <input type="number" value="1" id="experiment-value" />
            <input id="set-bucket-button" type="button" class="update-button btn btn-primary" value="Set Bucket!" />
            <br>

            <label>Hotel ID</label>
            <input type="number" value="5" id="hotel-id"/>
            <input id="go-is-button" type="button" class="update-button btn btn-primary" value="Go to Infosite!" />
            <input id="go-is-trip-button" type="button" class="update-button btn btn-primary" value="Go to Infosite from Trip Advisor!" />
            <br>

            <label>City Name</label>
            <input type="text" value="Los Angeles" id="city-name"/>
            <input id="go-sr-button" type="button" class="update-button btn btn-primary" value="Search Results!" />
            <br>
            <input id="home-button" type="button" class="update-button btn btn-primary" value="Home Page." />

            <br><br>

            <input type='checkbox' id='checkbox-use-dates' checked='yes'/>
            <label for='checkbox-use-dates'>put dates in url</label>
            <input type="number" id='dates-offset' value='30' size='3'/>
            <input type="number" id='dates-duration' value='5' size='3'/>
            <br>
            <input type='checkbox' id='checkbox-create-link'  checked='yes'/>
            <label for='checkbox-create-link'>do not navigate, but show URL here</label>
            <br>
            <a id='inject-link-here' target="_tab" style="max-width=400px">.</a>
            <br>

            <p>
                <!-- <input id="mobile-on" type="button" class="update-button btn btn-primary" value="Turn On Mobile" /> -->
            <input id="clean-button" type="button" class="update-button btn btn-primary" value="Reset Abacus Overrides" />
            <br>
            <input id="unrand-button" type="button" class="update-button btn btn-primary" value="Turn off Random Abacus" />

            <table border="1">
                <tr>
                    <td>Experiments:<td>
                </tr>
                <tr class="experiment">
                    <td>6248</td>
                    <td>HSR and HIS combined</td>
                </tr>
                <tr class="experiment">
                    <td>6172</td>
                    <td>Only HSR - Hotel Search Results</td>
                </tr>
                <tr class="experiment">
                    <td>6169</td>
                    <td>Only HIS - Hotel Infosite</td>
                </tr>
                <tr class="experiment">
                    <td>3082</td>
                    <td>supress eds popup</td>
                </tr>
                <tr class="experiment">
                    <td>2510</td>
                    <td>domain v2</td>
                </tr>
                <tr>
                    <td>Hotels:<td>
                </tr>
                <!--<tr onclick="$('#hotel-id').val(5); $('#city-name').val('Los Angeles, CA')">-->
                <tr id="hotel1">
                    <td>5</td>
                    <td>ESR : Sheraton Los Angeles</td>
                </tr>
                <!--<tr onclick="$('#hotel-id').val(140596); $('#city-name').val('Las Vegas, Nevada')">-->
                <tr id="hotel2">
                    <td>140596</td>
                    <td>ESR : Bellagio</td>
                <!--<tr onclick="$('#hotel-id').val(4925017); $('#city-name').val('Mestre, Italy')">-->
                <tr id="hotel3">
                    <td>4925017</td>
                    <td>ETP : later, IT</td>
                </tr>
                <!--<tr onclick="$('#hotel-id').val(27566); $('#city-name').val('Santa Cruz, CA')">-->
                <tr id="hotel4">
                    <td>27566</td>
                    <td>ETP : deposit, CA</td>
                </tr>
                <!--<tr onclick="$('#hotel-id').val(3893017); $('#city-name').val('Saudi Arabia')">-->
                <tr id="hotel5">
                    <td>3893017</td>
                    <td>Pegasus : Corp Exec, Saudi</td>
                </tr>
                <!--<tr onclick="$('#hotel-id').val(2281311); $('#city-name').val('Sold Out')">-->
                <tr id="hotel6">
                    <td>2281311</td>
                    <td>Sold Out</td>
                </tr>
                <!--<tr onclick="$('#hotel-id').val(2847); $('#city-name').val('Surfside, FL')">-->
                <tr id="hotel7">
                    <td>2847</td>
                    <td>Inactive Generic</td>
                </tr>
                <!--<tr onclick="$('#hotel-id').val(534776); $('#city-name').val('Kissimmee, FL')">-->
                <tr id="hotel8">
                    <td>534776</td>
                    <td>Inactive With Site</td>
                </tr>
                <!--<tr onclick="$('#hotel-id').val(1831238); $('#city-name').val('Chicago, IL')">-->
                <tr id="hotel9">
                    <td>1831238</td>
                    <td>Inactive With Reviews</td>
                </tr>
                <!--<tr onclick="$('#hotel-id').val(4049454); $('#city-name').val('Cloud, FL')">-->
                <tr id="hotel10">
                    <td>4049454</td>
                    <td>Inactive With Site and Reviews</td>
                </tr>
            </table>
            . . . . click a row<br>
            * tablet may break when using this tool, i.e. empty hero, to recover:<br>
            1. minimize browsers by pressing the button<br>
            2. show processes by double clicking the button<br>
            3. enter kill mode via press and hold Safari icon<br>
            4. kill Safari by pressing the "-" on Safari<br>
            5. re-open Safari = should work fine.
        </fieldset>
    </form>
</div>
<script>
    function navigateToUrl( url ){
        var show_url = document.getElementById('checkbox-create-link').checked;
        if( show_url )
        {
            document.getElementById('inject-link-here').href = url;
            document.getElementById('inject-link-here').innerHTML = url;
        }
        else
        {
            window.open( url );
        }
    }

    function getEnvironment() {
        var prepped_domain = '';

        var environment_text = document.getElementById('environmentDropDown').value;
        var raw_domain = document.getElementById('POS').value;

        if (environment_text.length > 0) {
            raw_domain = raw_domain.replace(/\./g, '');
            prepped_domain = raw_domain + environment_text;
        } else {
            prepped_domain = raw_domain;
        }
        if (environment_text.match('pull_from_edit_box')) {
            prepped_domain = $('#local-host-ip').val();
        }
        return prepped_domain;
    }

    function generateUrlForSetBucket(environmentUrl, experimentId, experimentValue) {
        var experimentMiddle = 0;
        var experimentBucket = 0;
        var valueParts = experimentValue.split(/\D+/);
        if( valueParts ){
            if( valueParts.length > 0 ){
                experimentBucket = valueParts[0];
            }
            if( valueParts.length > 1 ){
                experimentMiddle = valueParts[0];
                experimentBucket = valueParts[1];
            }
        }
        return 'http://' + environmentUrl + '/tools/abacus/overrides?abov=' + experimentId + '|' + experimentMiddle + '|' + experimentBucket;
    }

    function generateUrlForSeeBucket(environmentUrl, experimentId) {
        return 'http://' + environmentUrl + '/tools/abacus/test?expid=' + experimentId;
    }

    function calculateDate(offset)
    {
        var date_result = {
            day: '01',
            month: '04',
            year: '2015'
        };

        try
        {
            var start_date = new Date();
            start_date.setDate( start_date.getDate() + offset );

            var day_start = start_date.getDate();
            if( day_start < 10 )
            {
                day_start = '0' + day_start;
            }
            var month_start = start_date.getMonth() + 1;
            if( month_start < 10 )
            {
                month_start = '0' + month_start;
            }
            var year_start = start_date.getYear() + 1900;

            date_result.day = day_start;
            date_result.month = month_start;
            date_result.year = year_start;
        }
        catch(e)
        {
            console.error('calcuate date offset: ' + e.message);
        }
        return date_result;
    }

    function buildUrlArgs( page_type ){
        if( document.getElementById('checkbox-use-dates').checked ){
            var offset = document.getElementById('dates-offset').value / 1;
            var duration = document.getElementById('dates-duration').value / 1;
            var start_date = calculateDate( offset );
            var end_date = calculateDate( offset + duration );
            if( page_type == 'hsr' ){
                // &startDate=01/06/2015&startDate=01/12/2015
                return "&adults=2&sort=mostPopular&page=1&regionId=178280" +
                        "daysInFuture=" + offset +
                        "&stayLength=" + duration;
            } else {
                return "chkin=" + start_date.month + "-" + start_date.day + "-" + start_date.year +
                        "&chkout=" + end_date.month + "-" + end_date.day + "-" + end_date.year;
            }
        } else {
            return '';
        }
    }

    function generateUrlForTripAdvisor(environmentUrl, hotelId) {
        /* http://wwwexpediacom.trunk.sb.karmalab.net/MobileHotel/Offers?hotelId=2163007&useCacheForAirAttach=false&checkInDate=2014-12-17&checkOutDate=2014-12-18&room1=2&chkin=5/17/2014&tpid=1&ICMDTL=htl.2163007.taid.1152288.geoid.60878.testslice..clickid.VH33wgokKGkAAE2kIzgAAAAS&chkout=5/18/2014&eapid=21187&mctc=9&paandi=true&rm1=a2&ICMCID=Meta.tripa.Expedia_US-MP */

        var environmentUrl = getEnvironment();
        var offset = document.getElementById('dates-offset').value;
        var duration = document.getElementById('dates-duration').value;
        var start_date = calculateDate( offset );
        var end_date = calculateDate( duration );

        return 'http://' + environmentUrl + '/MobileHotel/Offers?hotelId=' + hotelId +
                '&useCacheForAirAttach=false' +
                    // '&checkInDate=2015-5-17' +
                '&checkInDate=' + start_date.year + '-' + start_date.month + '-' + start_date.day +
                    // '&checkOutDate=2015-5-18' +
                '&checkOutDate=' +  + end_date.year + '-' + end_date.month + '-' + end_date.day +
                '&room1=2' +
                    // '&chkin=5/17/2015' +
                '&chkin=' + start_date.month + '/' + start_date.day + '/' + start_date.year +
                '&tpid=1&ICMDTL=htl.2163007.taid.1152288.geoid.60878.testslice..clickid.VH33wgokKGkAAE2kIzgAAAAS' +
                    // '&chkout=5/18/2015' +
                '&chkout=' + end_date.month + '/' + end_date.day + '/' + end_date.year +
                '&eapid=21187&mctc=9&paandi=true&rm1=a2&ICMCID=Meta.tripa.Expedia_US-MP';
    }

    function generateUrlForIS(environmentUrl, hotelId) {
        // https://www.expedia.com/go/hotel/info/12345/2017-04-19/2017-04-27?SrchCity=SEA&NumRoom=1&NumAdult-Room1=1
//        return 'http://' + environmentUrl + '/h' + hotelId + '.Hotel-Information?' + buildUrlArgs();

        var environmentUrl = getEnvironment();
        var offset = document.getElementById('dates-offset').value / 1;
        var duration = document.getElementById('dates-duration').value / 1;
        var start_date = calculateDate( offset );
        var end_date = calculateDate( offset + duration );

        var date_a = start_date.year + '-' + start_date.month + '-' + start_date.day;
        var date_b = end_date.year + '-' + end_date.month + '-' + end_date.day;

        return 'http://' + environmentUrl + '/go/hotel/info/' + hotelId + '/' + date_a + '/' + date_b + '?NumRoom=1&NumAdult-Room1=1';
    }

    function generateUrlForSR(environmentUrl, cityName) {
        // https://www.expedia.com/go?type=Hotel-Search&destination=NYC&daysInFuture=35&stayLength=8
        //             var end_date = calculateDate( offset + duration );

        var offset = document.getElementById('dates-offset').value / 1;
        var duration = document.getElementById('dates-duration').value / 1;

        return 'http://' + environmentUrl + '/go?type=Hotel-Search&destination=' + cityName + '&daysInFuture=' + offset + '&stayLength=' + duration;
    }

    $('#set-bucket-button').click(function() {
        var environmentUrl = getEnvironment();
        var experimentId = $('#experiment-id').val();
        var experimentValue = $('#experiment-value').val();

        navigateToUrl(generateUrlForSetBucket(environmentUrl, experimentId, experimentValue));
    });

    $('#see-bucket-button').click(function() {
        var environmentUrl = getEnvironment();
        var experimentId = $('#experiment-id').val();

        navigateToUrl(generateUrlForSeeBucket(environmentUrl, experimentId));
    });

    $('#store-experiment-button').click(function() {
        var experimentId = $('#experiment-id').val();
        var experimentName = $('#experiment-name').val();

        var saved_experiments = '{}';

        if (localStorage && localStorage.saved_experiments) {
            saved_experiments = localStorage.saved_experiments;
        }

        var saved_exp_obj = JSON.parse(saved_experiments);

        if (saved_exp_obj.exp_list) {
            for (var i = 0 ; i < saved_exp_obj.exp_list.length ; i++) {
                if (saved_exp_obj.exp_list[i].id == experimentId) {
                    // splice out the item
                    saved_exp_obj.exp_list.splice(i,1);
                    // put counter back to zero
                    i = i - 1;
                }
            }
        }

        if (saved_exp_obj && saved_exp_obj.exp_list && saved_exp_obj.exp_list.length > 5) {
            saved_exp_obj.exp_list.pop();
        }

        if (!saved_exp_obj.exp_list) {
            saved_exp_obj.exp_list = [];
        }

        saved_exp_obj.exp_list.unshift({
            id: experimentId,
            name: experimentName
        });

        localStorage.saved_experiments = JSON.stringify(saved_exp_obj);

        updateExperimentsFromLocalStorage();
    });

    $('#go-is-button').click(function() {
        var environmentUrl = getEnvironment();
        var hotelId = $('#hotel-id').val();

        navigateToUrl(generateUrlForIS(environmentUrl, hotelId));
    });

    $('#go-is-trip-button').click(function() {
        var environmentUrl = getEnvironment();
        var hotelId = $('#hotel-id').val();

        navigateToUrl(generateUrlForTripAdvisor(environmentUrl, hotelId));
    });

    $('#go-sr-button').click(function() {
        var environmentUrl = getEnvironment();
        var cityName = $('#city-name').val();

        navigateToUrl(generateUrlForSR(environmentUrl, cityName));
    });

    $('#mobile-off').click(function() {
        var mobileOffUrl = 'http://' + getEnvironment() + '/?stop_mobi=yes&rfrr=Mobile.Stop';
        navigateToUrl( mobileOffUrl );
    });

    $('#6248-HSR-HIS-Combined').click(function() {
        var bucketHsrHisCombined = 'http://' + getEnvironment() + '/tools/abacus/overrides?abov=6248|1|1';
        navigateToUrl( bucketHsrHisCombined );
    });

    $('#6172-HSR-Only').click(function() {
        var bucketHsrOnly = 'http://' + getEnvironment() + '/tools/abacus/overrides?abov=6172|1|1';
        navigateToUrl( bucketHsrOnly );
    });

    $('#6169-HIS-Only').click(function() {
        var bucketHisOnly = 'http://' + getEnvironment() + '/tools/abacus/overrides?abov=6169|1|1';
        navigateToUrl( bucketHisOnly );
    });


    $('#mobile-experiments').click(function() {
        var bucketMobileExperimentsUrl = 'http://' + getEnvironment() + '/tools/abacus/overrides?abov=4528|0|0:6060|0|1:6038|0|1:6043|0|1:6040|0|1:6050|0|1:5980|0|1:5983|0|1:6089|0|1:6132|0|1:-3|-1|-1:5226|0|1:5968|0|1:6006|0|1:6062|0|1:6063|0|1:6064|0|1';
        navigateToUrl( bucketMobileExperimentsUrl );
    });

    $('#clean-button').click(function() {
        var cleanUrl = 'http://' + getEnvironment() + '/tools/abacus/overrides?clean=1';
        navigateToUrl( cleanUrl );
    });

    $('#unrand-button').click(function() {
        var cleanUrl = 'http://' + getEnvironment() + '/tools/abacus/overrides?abov=-3|-1|-1';
        navigateToUrl( cleanUrl );
    });

    $('#home-button').click(function() {
        var homeUrl = 'http://' + getEnvironment();
        navigateToUrl( homeUrl );
    });

    $('tr').click(selectExperiment);

    function selectExperiment(evt) {
        console.log('select experiment');
        console.log(evt.target);
        console.log(evt.target.parentElement);

        var row = evt.target.parentElement;
        var exp_id = row.children[0].innerHTML;
        var exp_name = row.children[1].innerHTML;

        $('#experiment-id').val(exp_id);
        $('#experiment-name').val(exp_name);
    }

    function updateExperimentsFromLocalStorage() {
        var saved_exp_obj = {};
        if (localStorage && localStorage.saved_experiments) {
            saved_exp_obj = JSON.parse(localStorage.saved_experiments);
        }
        if (saved_exp_obj.exp_list) {
            for (var i = 0 ; i < saved_exp_obj.exp_list.length ; i++) {
                $('.experiment').eq(i).find('td').eq(0).text( saved_exp_obj.exp_list[i].id );
                $('.experiment').eq(i).find('td').eq(1).text( saved_exp_obj.exp_list[i].name );
            }
        }
    }
    updateExperimentsFromLocalStorage();

</script>
</body>
</html>